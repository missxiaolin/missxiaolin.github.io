<!DOCTYPE html><html lang="zh-CN"><head><meta http-equiv="content-type" content="text/html; charset=utf-8"><meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" name="viewport"><meta content="yes" name="apple-mobile-web-app-capable"><meta content="black-translucent" name="apple-mobile-web-app-status-bar-style"><meta content="telephone=no" name="format-detection"><meta name="description"><title>RESTful风格的API | 你总是这样轻言放弃的话，无论多久你都只会原地踏步。</title><link rel="stylesheet" type="text/css" href="//cdn.bootcss.com/normalize/5.0.0/normalize.min.css"><link rel="stylesheet" type="text/css" href="//cdn.bootcss.com/pure/0.6.2/pure-min.css"><link rel="stylesheet" type="text/css" href="//cdn.bootcss.com/pure/0.6.2/grids-responsive-min.css"><link rel="stylesheet" type="text/css" href="/css/style.css?v=0.0.0"><link rel="stylesheet" href="//cdn.bootcss.com/font-awesome/4.7.0/css/font-awesome.min.css"><script type="text/javascript" src="//cdn.bootcss.com/jquery/3.1.1/jquery.min.js"></script><link rel="Shortcut Icon" type="image/x-icon" href="/favicon.ico"><link rel="apple-touch-icon" href="/apple-touch-icon.png"><link rel="apple-touch-icon-precomposed" href="/apple-touch-icon.png"></head><body><div class="body_container"><div id="header"><div class="site-name"><h1 class="hidden">RESTful风格的API</h1><a id="logo" href="/.">你总是这样轻言放弃的话，无论多久你都只会原地踏步。</a><p class="description"></p></div><div id="nav-menu"><a href="/." class="current"><i class="fa fa-home"> 首页</i></a><a href="/archives/"><i class="fa fa-archive"> 归档</i></a><a href="/about/"><i class="fa fa-user"> 关于</i></a><a href="/atom.xml"><i class="fa fa-rss"> 订阅</i></a></div></div><div id="layout" class="pure-g"><div class="pure-u-1 pure-u-md-3-4"><div class="content_container"><div class="post"><h1 class="post-title">RESTful风格的API</h1><div class="post-meta">Apr 26, 2017<span> | </span><span class="category"><a href="/categories/PHP/">PHP</a><a href="/categories/PHP/yii/">yii</a></span><script src="https://dn-lbstatics.qbox.me/busuanzi/2.3/busuanzi.pure.mini.js" async></script><span id="busuanzi_container_page_pv"> | <span id="busuanzi_value_page_pv"></span><span> Hits</span></span></div><a data-thread-key="2017/04/26/php/yii restful api/" href="/2017/04/26/php/yii restful api/#comments" class="ds-thread-count"></a><div class="post-content"><h3 id="什么是RESTful风格的API"><a href="#什么是RESTful风格的API" class="headerlink" title="什么是RESTful风格的API"></a>什么是RESTful风格的API</h3><p>对于各种客户端设备与服务端的通信，我们往往都通过API为客户端提供数据，提供某种资源。关于RESTful的概念，一查一大推，一两句也解释不清，姑且先按照我们通俗的理解：在众多风格、众多原则的API中，RESTful就是一套比较优秀的接口调用方式。</p>
<h3 id="建立单独的应用程序"><a href="#建立单独的应用程序" class="headerlink" title="建立单独的应用程序"></a>建立单独的应用程序</h3><p>为了增加程序的可维护性，易操作性，我们选择新建一套应用程序，这也是为了和前台应用、后台应用区分开操作。有些人要嚷嚷了，为啥非得单独搞一套呢？如果你就单纯的提供个别的几个h5页面的话，那就没有必要了，但事实往往是客户端要升级啊，要增加不同的版本啊，这就需要我们不但要后端不仅要增加一套单独的应用程序，我们还要增加各种版本去控制。</p>
<p>下载yii高级模板 可以复制一个（frontend）或者 （backend） 到项目文件夹位置</p>
<p>修改common\config\bootstrap.php文件<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Yii::setAlias(&apos;@api&apos;, dirname(dirname(__DIR__)) . &apos;/api&apos;);</span><br></pre></td></tr></table></figure></p>
<p>然后在environments目录的dev和prod里面增加api目录 同样可以复制（frontend）或者 （backend）</p>
<p><img src="http://oni42o7kl.bkt.clouddn.com/yii%20api%E9%85%8D%E7%BD%AE.png"></p>
<p>nginx配置下这样就可以访问到api了</p>
<h3 id="配置错误日志"><a href="#配置错误日志" class="headerlink" title="配置错误日志"></a>配置错误日志</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">&apos;log&apos; =&gt; [</span><br><span class="line">    &apos;traceLevel&apos; =&gt; YII_DEBUG ? 3 : 0,</span><br><span class="line">    &apos;targets&apos;    =&gt; [</span><br><span class="line">        [</span><br><span class="line">            &apos;class&apos;   =&gt; &apos;yii\log\FileTarget&apos;,</span><br><span class="line">            &apos;levels&apos;  =&gt; [&apos;error&apos;, &apos;warning&apos;],</span><br><span class="line">            &apos;logFile&apos; =&gt; &quot;@runtime/logs/&quot; . date(&apos;Y-m&apos;) . &apos;/&apos; . date(&apos;d&apos;) . &apos;/&apos; . date(&apos;H&apos;) . &quot;-app.log&quot;,</span><br><span class="line">        ],</span><br><span class="line">    ],</span><br><span class="line">],</span><br></pre></td></tr></table></figure>
<h3 id="美化路由"><a href="#美化路由" class="headerlink" title="美化路由"></a>美化路由</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">&apos;urlManager&apos; =&gt; [</span><br><span class="line">    &apos;enablePrettyUrl&apos; =&gt; true,</span><br><span class="line">    &apos;showScriptName&apos; =&gt; false,</span><br><span class="line">    &apos;enableStrictParsing&apos;=&gt;true,</span><br><span class="line">    &apos;rules&apos; =&gt; [</span><br><span class="line">    ],</span><br><span class="line">],</span><br></pre></td></tr></table></figure>
<h3 id="下面我们在api目录下建立一个modules目录"><a href="#下面我们在api目录下建立一个modules目录" class="headerlink" title="下面我们在api目录下建立一个modules目录"></a>下面我们在api目录下建立一个modules目录</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">├──────api</span><br><span class="line">│       │</span><br><span class="line">├───────modules</span><br><span class="line">│        └────v1</span><br><span class="line">│              ├─controllers</span><br><span class="line">│              │      BaseController.php</span><br><span class="line">               ├─Module.php</span><br></pre></td></tr></table></figure>
<p>为了能让我们访问到这个模块不要忘记在main.php中添加下面代码</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&apos;modules&apos; =&gt; [</span><br><span class="line">    &apos;v1&apos; =&gt; [</span><br><span class="line">        &apos;class&apos; =&gt; &apos;api\modules\v1\Module&apos;,</span><br><span class="line">    ],</span><br><span class="line">],</span><br></pre></td></tr></table></figure>
<p>继续设置下路由就可以访问到了</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">&apos;urlManager&apos;   =&gt; [</span><br><span class="line">    &apos;enablePrettyUrl&apos;     =&gt; true,</span><br><span class="line">    &apos;showScriptName&apos;      =&gt; false,</span><br><span class="line">    &apos;enableStrictParsing&apos; =&gt; true,</span><br><span class="line">    &apos;rules&apos;               =&gt; [</span><br><span class="line">        [</span><br><span class="line">            &apos;class&apos;      =&gt; &apos;yii\rest\UrlRule&apos;,</span><br><span class="line">            &apos;controller&apos; =&gt; [</span><br><span class="line">                &apos;v1/base/index&apos;,</span><br><span class="line">            ],</span><br><span class="line">        ],</span><br><span class="line">        &apos;GET  v1/base/index&apos; =&gt; &apos;v1/base/index&apos;</span><br><span class="line">    ],</span><br><span class="line">],</span><br></pre></td></tr></table></figure>
<h3 id="统一json返回"><a href="#统一json返回" class="headerlink" title="统一json返回"></a>统一json返回</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">&apos;response&apos;     =&gt; [</span><br><span class="line">    &apos;class&apos;         =&gt; &apos;yii\web\Response&apos;,</span><br><span class="line">    &apos;on beforeSend&apos; =&gt; function ($event) &#123;</span><br><span class="line">        $response = $event-&gt;sender;</span><br><span class="line">        $response-&gt;data = [</span><br><span class="line">            &apos;code&apos;    =&gt; $response-&gt;getStatusCode(),</span><br><span class="line">            &apos;data&apos;    =&gt; $response-&gt;data,</span><br><span class="line">            &apos;message&apos; =&gt; $response-&gt;statusText,</span><br><span class="line">        ];</span><br><span class="line">        $response-&gt;format = yii\web\Response::FORMAT_JSON;</span><br><span class="line">    &#125;,</span><br><span class="line">],</span><br></pre></td></tr></table></figure>
<h3 id="当然，yii2还对该api封装了如下操作："><a href="#当然，yii2还对该api封装了如下操作：" class="headerlink" title="当然，yii2还对该api封装了如下操作："></a>当然，yii2还对该api封装了如下操作：</h3><ul>
<li>GET /users: 逐页列出所有用户</li>
<li>HEAD /users: 显示用户列表的概要信息</li>
<li>POST /users: 创建一个新用户</li>
<li>GET /users/123: 返回用户 123 的详细信息</li>
<li>HEAD /users/123: 显示用户 123 的概述信息</li>
<li>PATCH /users/123 and PUT /users/123: 更新用户123</li>
<li>DELETE /users/123: 删除用户123</li>
<li>OPTIONS /users: 显示关于末端 /users 支持的动词</li>
<li>OPTIONS /users/123: 显示有关末端 /users/123 支持的动词</li>
</ul>
<h3 id="错误码"><a href="#错误码" class="headerlink" title="错误码"></a>错误码</h3><h3 id="接着来看一看RESTFul-API的一些最佳实践原则"><a href="#接着来看一看RESTFul-API的一些最佳实践原则" class="headerlink" title="接着来看一看RESTFul API的一些最佳实践原则:"></a>接着来看一看RESTFul API的一些最佳实践原则:</h3><p>1.使用HTTP动词表示增删改查资源， GET：查询，POST：新增，PUT：更新，DELETE：删除<br>2.返回结果必须使用JSON<br>3.HTTP状态码，在REST中都有特定的意义：200，201,202,204, 400,401,403,500。比如401表示用户身份认证失败，403表示你验证身份通过了，但这个资源你不能操作。<br>4.如果出现错误，返回一个错误码。比如我通常是这么定义的：</p>
<ul>
<li>200: OK。一切正常。</li>
<li>201: 响应 POST 请求时成功创建一个资源。Location header 包含的URL指向新创建的资源。</li>
<li>204: 该请求被成功处理，响应不包含正文内容 (类似 DELETE 请求)。</li>
<li>304: 资源没有被修改。可以使用缓存的版本。</li>
<li>400: 错误的请求。可能通过用户方面的多种原因引起的，例如在请求体内有无效的JSON 数据，无效的操作参数，等等。</li>
<li>401: 验证失败。</li>
<li>403: 已经经过身份验证的用户不允许访问指定的 API 末端。</li>
<li>404: 所请求的资源不存在。</li>
<li>405: 不被允许的方法。 请检查 Allow header 允许的HTTP方法。</li>
<li>415: 不支持的媒体类型。 所请求的内容类型或版本号是无效的。</li>
<li>422: 数据验证失败 (例如，响应一个 POST 请求)。 请检查响应体内详细的错误消息。</li>
<li>429: 请求过多。 由于限速请求被拒绝。</li>
<li>500: 内部服务器错误。 这可能是由于内部程序错误引起的。</li>
</ul>
<p>5.API必须有版本的概念，v1，v2，v3<br>6.使用Token令牌来做用户身份的校验与权限分级，而不是Cookie。<br>7.url中大小写不敏感，不要出现大写字母<br>8.使用 - 而不是使用 _ 做URL路径中字符串连接。<br>9.有一份漂亮的文档~（很重要）</p>
<p>以上只是列出了RESTFul的部分实践原则，并非全部。 </p>
</div><script type="text/javascript" src="/js/share.js?v=0.0.0" async></script><a data-url="http://yoursite.com/2017/04/26/php/yii restful api/" data-id="cjm5mjcea0036w9vottmxeoo8" class="article-share-link">分享到</a><div class="tags"><a href="/tags/php/">php</a></div><div class="post-nav"><a href="/2017/04/26/db/timestamp/" class="pre">timestamp default 默认值问题</a><a href="/2017/04/24/linux/MongoDB安装/" class="next">MongoDB安装</a></div><div data-thread-key="2017/04/26/php/yii restful api/" data-title="RESTful风格的API" data-url="http://yoursite.com/2017/04/26/php/yii restful api/" class="ds-share flat"><div class="ds-share-inline"><ul class="ds-share-icons-16"><li data-toggle="ds-share-icons-more"><a href="javascript:void(0);" class="ds-more">分享到：</a></li><li><a href="javascript:void(0);" data-service="weibo" class="ds-weibo">微博</a></li><li><a href="javascript:void(0);" data-service="qzone" class="ds-qzone">QQ空间</a></li><li><a href="javascript:void(0);" data-service="qqt" class="ds-qqt">腾讯微博</a></li><li><a href="javascript:void(0);" data-service="wechat" class="ds-wechat">微信</a></li></ul><div class="ds-share-icons-more"></div></div></div><div data-thread-key="2017/04/26/php/yii restful api/" data-title="RESTful风格的API" data-url="http://yoursite.com/2017/04/26/php/yii restful api/" data-author-key="1" class="ds-thread"></div></div></div></div><div class="pure-u-1 pure-u-md-1-4"><div id="sidebar"><div class="widget"><div class="widget-title"><i class="fa fa-folder-o"> 分类</i></div><ul class="category-list"><li class="category-list-item"><a class="category-list-link" href="/categories/Hexo/">Hexo</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/PHP/">PHP</a><span class="category-list-count">22</span><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/PHP/laravel/">laravel</a><span class="category-list-count">2</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/PHP/yii/">yii</a><span class="category-list-count">8</span></li></ul></li><li class="category-list-item"><a class="category-list-link" href="/categories/composer/">composer</a><span class="category-list-count">2</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/git/">git</a><span class="category-list-count">6</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/linux/">linux</a><span class="category-list-count">6</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/mysql/">mysql</a><span class="category-list-count">2</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/node/">node</a><span class="category-list-count">3</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/python/">python</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/rsa/">rsa</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/前端之巅/">前端之巅</a><span class="category-list-count">35</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/技术杂谈/">技术杂谈</a><span class="category-list-count">11</span></li></ul></div><div class="widget"><div class="widget-title"><i class="fa fa-star-o"> 标签</i></div><div class="tagcloud"><a href="/tags/linux/" style="font-size: 15px;">linux'</a> <a href="/tags/加密/" style="font-size: 15px;">加密</a> <a href="/tags/linux/" style="font-size: 15px;">linux</a> <a href="/tags/Docker/" style="font-size: 15px;">Docker</a> <a href="/tags/git/" style="font-size: 15px;">git</a> <a href="/tags/Hexo/" style="font-size: 15px;">Hexo</a> <a href="/tags/kafka/" style="font-size: 15px;">kafka</a> <a href="/tags/php/" style="font-size: 15px;">php</a> <a href="/tags/composer/" style="font-size: 15px;">composer</a> <a href="/tags/kong/" style="font-size: 15px;">kong</a> <a href="/tags/mysql/" style="font-size: 15px;">mysql</a> <a href="/tags/前端之巅/" style="font-size: 15px;">前端之巅</a> <a href="/tags/elasticsearch/" style="font-size: 15px;">elasticsearch</a> <a href="/tags/python/" style="font-size: 15px;">python</a> <a href="/tags/前端/" style="font-size: 15px;">前端</a> <a href="/tags/nginx/" style="font-size: 15px;">nginx</a> <a href="/tags/java/" style="font-size: 15px;">java</a></div></div><div class="widget"><div class="widget-title"><i class="fa fa-file-o"> 最新文章</i></div><ul class="post-list"><li class="post-list-item"><a class="post-list-link" href="/2018/09/17/php/基于supervisor秒级Laravel定时任务/">基于supervisor秒级Laravel定时任务</a></li><li class="post-list-item"><a class="post-list-link" href="/2018/09/15/php/区间Range重叠算法/">区间Range重叠算法</a></li><li class="post-list-item"><a class="post-list-link" href="/2018/09/14/mysql/MySQL查找和删除重复记录/">MySQL查找和删除重复记录</a></li><li class="post-list-item"><a class="post-list-link" href="/2018/08/25/前端/vue(四)/">vue 线上部署(四)</a></li><li class="post-list-item"><a class="post-list-link" href="/2018/07/26/php/PHP中使用AMQP消息队列|LNMP/">PHP中使用AMQP消息队列|LNMP</a></li><li class="post-list-item"><a class="post-list-link" href="/2018/07/20/前端/小程序3/">小程序（三）</a></li><li class="post-list-item"><a class="post-list-link" href="/2018/07/19/前端/小程序2/">小程序（二）</a></li><li class="post-list-item"><a class="post-list-link" href="/2018/07/18/前端/小程序1/">小程序（一）</a></li><li class="post-list-item"><a class="post-list-link" href="/2018/07/17/前端/项目管理/">项目管理</a></li><li class="post-list-item"><a class="post-list-link" href="/2018/07/09/前端/JavaScript中的深拷贝和浅拷贝/">JavaScript中的深拷贝和浅拷贝</a></li></ul></div><div class="widget"><div class="comments-title"><i class="fa fa-comment-o"> 最近评论</i></div><div data-num-items="5" data-show-avatars="0" data-show-time="1" data-show-admin="0" data-excerpt-length="32" data-show-title="1" class="ds-recent-comments"></div></div></div></div><div class="pure-u-1 pure-u-md-3-4"><div id="footer">© <a href="/." rel="nofollow">你总是这样轻言放弃的话，无论多久你都只会原地踏步。.</a> Powered by<a rel="nofollow" target="_blank" href="https://hexo.io"> Hexo.</a><a rel="nofollow" target="_blank" href="https://github.com/tufu9441/maupassant-hexo"> Theme</a> by<a rel="nofollow" target="_blank" href="https://github.com/pagecho"> Cho.</a></div></div></div><a id="rocket" href="#top" class="show"></a><script type="text/javascript" src="/js/totop.js?v=0.0.0" async></script><script type="text/javascript" src="//cdn.bootcss.com/fancybox/2.1.5/jquery.fancybox.pack.js" async></script><script type="text/javascript" src="/js/fancybox.js?v=0.0.0" async></script><link rel="stylesheet" type="text/css" href="/css/jquery.fancybox.css?v=0.0.0"><script>var duoshuoQuery = {short_name:'xiaolinouye'};
(function() {
    var ds = document.createElement('script');
    ds.type = 'text/javascript';ds.async = true;
    ds.src = (document.location.protocol == 'https:' ? 'https:' : 'http:') + '//static.duoshuo.com/embed.js';
    ds.charset = 'UTF-8';
    (document.getElementsByTagName('head')[0]
        || document.getElementsByTagName('body')[0]).appendChild(ds);
})();
</script><script type="text/javascript" src="/js/codeblock-resizer.js?v=0.0.0"></script><script type="text/javascript" src="/js/smartresize.js?v=0.0.0"></script></div></body></html>
<!DOCTYPE html><html lang="zh-CN"><head><meta http-equiv="content-type" content="text/html; charset=utf-8"><meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" name="viewport"><meta content="yes" name="apple-mobile-web-app-capable"><meta content="black-translucent" name="apple-mobile-web-app-status-bar-style"><meta content="telephone=no" name="format-detection"><meta name="description"><title>Docker 初级入门 | 你总是这样轻言放弃的话，无论多久你都只会原地踏步。</title><link rel="stylesheet" type="text/css" href="//cdn.bootcss.com/normalize/5.0.0/normalize.min.css"><link rel="stylesheet" type="text/css" href="//cdn.bootcss.com/pure/0.6.2/pure-min.css"><link rel="stylesheet" type="text/css" href="//cdn.bootcss.com/pure/0.6.2/grids-responsive-min.css"><link rel="stylesheet" type="text/css" href="/css/style.css?v=0.0.0"><link rel="stylesheet" href="//cdn.bootcss.com/font-awesome/4.7.0/css/font-awesome.min.css"><script type="text/javascript" src="//cdn.bootcss.com/jquery/3.1.1/jquery.min.js"></script><link rel="Shortcut Icon" type="image/x-icon" href="/favicon.ico"><link rel="apple-touch-icon" href="/apple-touch-icon.png"><link rel="apple-touch-icon-precomposed" href="/apple-touch-icon.png"></head><body><div class="body_container"><div id="header"><div class="site-name"><h1 class="hidden">Docker 初级入门</h1><a id="logo" href="/.">你总是这样轻言放弃的话，无论多久你都只会原地踏步。</a><p class="description"></p></div><div id="nav-menu"><a href="/." class="current"><i class="fa fa-home"> 首页</i></a><a href="/archives/"><i class="fa fa-archive"> 归档</i></a><a href="/about/"><i class="fa fa-user"> 关于</i></a><a href="/atom.xml"><i class="fa fa-rss"> 订阅</i></a></div></div><div id="layout" class="pure-g"><div class="pure-u-1 pure-u-md-3-4"><div class="content_container"><div class="post"><h1 class="post-title">Docker 初级入门</h1><div class="post-meta">Aug 26, 2017<span> | </span><span class="category"><a href="/categories/技术杂谈/">技术杂谈</a></span><script src="https://dn-lbstatics.qbox.me/busuanzi/2.3/busuanzi.pure.mini.js" async></script><span id="busuanzi_container_page_pv"> | <span id="busuanzi_value_page_pv"></span><span> Hits</span></span></div><a data-thread-key="2017/08/26/dock/Docker 初级入门/" href="/2017/08/26/dock/Docker 初级入门/#comments" class="ds-thread-count"></a><div class="post-content"><h2 id="Docker"><a href="#Docker" class="headerlink" title="Docker"></a>Docker</h2><p>旨在指导成员快速对Docker 理解并使用到开发环境中。它能在多个维度加快开发效率，快速对市面上已知的软件产品理解与应用。<br>当然，对于产品级Docker级的应用及其编排策略才是Docker大显身手之地，但此篇文章不作太多赘述。</p>
<h2 id="分步指南"><a href="#分步指南" class="headerlink" title="分步指南"></a>分步指南</h2><p>1.What， Docker 是什么<br>2.Why,    为什么要用<br>3,理解其简单结构并可使用。</p>
<p>What is Docker<br>1，Docker是什么<br>Docker 是一个开源的应用容器引擎，让开发者可以打包他们的应用以及依赖包到一个可移植的容器中，然后发布到任何流行的 Linux 机器上，也可以实现虚拟化。容器是完全使用沙箱机制，相互之间不会有任何接口。<br>上述为百度“Docker”原话粘贴，可以自行再去搜索更多相关解释。这里标了两个关键字 “容器”， 和“可移植”。 由于它利用的是Linux内核的LXC（一个开源项目）技术，所以目前只能运行于Linux操作系统之下，所有你看到的有关 Windows及 Mac或非Linux(“非”包括Unix和BSD等)的Docker安装，都是基于一层VM即虚拟机之上搭建。<br>针对于容器， 对其理解需要记住：不同于虚拟机VM，通常基于物理机之上，操作系统级别，出现故障第一时间是修复；而容器是基于操作系统之上，进程级别， 出现故障第一时间是干掉，即kill。（PS：虽然你发现Docker在分层上是 scratch &gt; [OS] &gt; [Env套件] ，还是有一层OS，但你在宿主机上ps -A 会看到容器内的运行进程的。实现细节有兴趣可以自行了解）</p>
<table>
<thead>
<tr>
<th></th>
<th>宿主</th>
<th>级别（虚拟出对象）</th>
<th>出问题解决方案</th>
<th>对资源配比利用</th>
</tr>
</thead>
<tbody>
<tr>
<td>VM</td>
<td>物理机</td>
<td>OS</td>
<td>找到问题并修复</td>
<td></td>
<td></td>
</tr>
<tr>
<td>LXC</td>
<td>OS</td>
<td>进程</td>
<td>Kill掉 重启一个</td>
<td></td>
</tr>
</tbody>
</table>
<p>对于 可移植，是说容器是创建于定义好的镜像 的，镜像是什么？ 比较于 类和对象的理解，可以把镜像看成是类，而容器是某个类的对象， 即是镜像的一个实例。</p>
<p>通常通过Dockerfile创建(build)出的产物即是镜像(image)，用散列码（image id）区分，该产物（image）可以上传(push)于Docker Registry, 并可被任意安装了Docker的Linux下载(pull), 从而在该机上启动（run）一个容器实例（container）. 运行于 Linux机器的上的多个容器也用散列码（container）id区分。</p>
<p>可以这样理解：image叫做 容器类别 ， container是 容器实例。</p>
<p>下面用流程图来分步解释常用的命令：</p>
<p><img src="http://oni42o7kl.bkt.clouddn.com/Docker.jpg"></p>
<p>从Create Image–→ Created Image; 1 从Pull Image —→ Pulled Image; 2 从Run Docker Container —→ Ran Docker Container ; 3 一共三个流程。<br>首先介绍两个概念， Registry, 和 Repository.<br>这两个库存的概念都是在它的移植性上的。<br>Registry是中央仓库，用以集中存放Docker 镜像的一个Service, 像阿里，Daocloud都有存放docker 镜像的中央仓库。你也可以搭建自己的Docker registry, 新版(3.x以上)的Nexus集成了这个功能。</p>
<p>官方的Registry是docker.io, 也是默认的Registry, 在需要填入registry的地方可省略，即默认使用官方中央仓库。 如 docker login [daocloud.io]Repository,是在中央仓库中，对镜像的分类。通常你可以在中央仓库中建立组织（Group）, 在组下建立 Repository, 类似github存放代码的管理形式, 所以你查看中央仓库中的GUI web页面，是通过 hub.docker.com访问的， 也是一种hub. docker Hub。 对于存放于每一个Repository的不同 image可以打上标签(tag)进行区分，通常用的是版本号。</p>
<p>例如，你的团队 monster开发的一个软件产品叫 playgroud, 那么你建立的该产品的docker 镜像就是 monster/playgroud。</p>
<p>你公司自建中央仓库地址为d.enmonster.com 就是d.enmonster.com/monster/playground. 该软件产品会进行版本迭代，那么就会有 <a href="http://d.enmonster.com/monster/playground:1.1.1" target="_blank" rel="external">d.enmonster.com/monster/playground:1.1.1.</a><br>这样一个产品，对于上图流程1，就是 docker build -t d.enmonster.com/monster/playground:1.1.1 -f [/path/to/Dockerfile] 建立成功后 docker push d.enmonster.com/monster/playground:1.1.1</p>
<p>那么其它人，或你在其它机器上拿这个镜像的方法就是流程2， docker pull <a href="http://d.enmonster.com/monster/playground:1.1.1" target="_blank" rel="external">d.enmonster.com/monster/playground:1.1.1</a></p>
<p>在docker images 可以查到有这个镜像 在你的机器上时，就可以通过docker run d.enmonster.com/monster/playground:1.1.1来运行起这样一个实例。<br>当然，通常docker run 需要很多其它参数。</p>
<p>正常运行后，docker ps 可以查看到正在运行的实例列表。可以通过 docker stop [container id]/[container name] 或 docker restart [container id]/[container name]对正在运行的容器进行 停止和 重启操作。docker ps -a 可以查看到所有本机的容器实例。可以通过docker start, docker rm 对该实例列表中已停止的实例进行启动和删除操作。</p>
<p>最好不要： 由于docker 是进程级别的虚拟技术，虽然用操作系统层来隔离与宿主的环境，但是最好不要在一个容器中挂起多个进程。你完全可以把docker 本身看作一种进程管理工具。一个容器就起一个进程，在容器中是默认 pid=1的那个进程。</p>
<h2 id="Why-docker"><a href="#Why-docker" class="headerlink" title="Why docker"></a>Why docker</h2><p>2，为什么用Docker<br>Docker 的作用，从根本上是解决 软件产品交付时，对环境的依赖问题。<br>例如，你在CentOS7下开发出一款 基于Python3.6构建的软件产品。在交付使用方时，你需要书写说明书向使用方说明 该如何运行起你的软件产品。在你费了大量的人力物力向其解释，你需要在某台机器上安装Centos系统，再在CentOS中安装 了Python3.6，再安装pip, 通过pip 安装好依赖包列表中的所有依赖后，再运行你的产品。使用方会有各种各样的反馈，诸如“它为什么不能在Windows上运行。” “我机器上有python2并不想再装python3, 怕其互相影响”。 诸如此类的问题。会大大延长软件产品的交付时间。<br>这种情况不仅存在于公司间的乙方向甲方交付软件产品的情况，也存在于公司内部，开发向运维交付产品时。<br>另外一方面在成群大规模的集群 软件产品持续批量部署上，带来很大的时间成本与维护成本的节省 。 基于本文为初级入门，现只针对单机开发时，它所带来的好处作简单介绍：<br>基本上你喜欢在虚拟机里做的事情，容器都可以做到，而且你会发现这些事情，你会更喜欢用容器去做。<br>1, 沙箱，环境隔离，为了踩一些试验性的坑，你不想这个坑影响到你的OS环境，以及OS其它软件的环境。<br>2，多机集群试验，你可以启动起多个镜像的容器实例，把它们联合起来，做集群部署试验。实例间组网实验。<br>相比于虚拟机，它有更进一步的优势在于：<br>3，秒级启动，停止。<br>4，无需维护，有故障直接kill, 重新run 一份。<br>5，对于听说的概念或软件产品，更加快速的体验其使用效果。例如，在听说物联网中一个MQTT的协议，你发现了有eclipse-mosquitto这样一个产品，你可以在docker hub中搜到它，并用docker pull + docker run 马上在你本地的docker 中跑起一个。而不像传统方式，无论物理机还是虚拟机，需要先下载该软件产品，安装它的依赖，java等等，有可能需要tomcat依赖到的jar 包。再去命令跑起。<br>你会很快发现，基本上在速度这个维度上，为你的工作，带来很大的提升。<br>最好：还是容器关键，进程 级别，少用它作数据保存，维护工具。它更多做的是运算，将数据保存在宿主机上映射到容器中是最优的做法。</p>
<h2 id="网络拓扑"><a href="#网络拓扑" class="headerlink" title="网络拓扑"></a>网络拓扑</h2><p>对在你机器上建立的Docker 的网络拓扑作一个简单的图示展现，便于更好更快地进行操作理解。</p>
<p><img src="http://oni42o7kl.bkt.clouddn.com/Network.png"></p>
<p>比如在一些调通配置上，如果理解成这样的具象，一些问题会不好排查到。</p>
<h2 id="常用命令"><a href="#常用命令" class="headerlink" title="常用命令"></a>常用命令</h2><p>最后，简单列下我在使用时，经常用到的命令。<br>对镜像的操作：<br>docker images //列出本机所有容器镜像<br>docker build //从Dockerfile描述中创建镜像<br>如 docker build -t enmonster/crm:1.0.1 -f Dockerfile . 句点指当前目录，f 参数是optional 的，默认会取所指目录下的Dockerfile<br>docker pull<br>如 docker pull python. 此命令有很多默认项，全部是： docker pull docker.io/library/python:latest<br>docker push<br>如 docker push enmonster/crm:latest<br>docker rmi<br>如 docker rmi enmonster/crm:latest<br>docker run<br>如docker run - -name python -it -d -v docker.io/library/python<br>对容器的操作:<br>docker ps -a // 列出本机所有容器实例 去掉a是列出运行中的容器实例。<br>docker start python //<br>docker stop python<br>docker restart python<br>docker exec python<br>docker attach python<br>docker rm python<br>可以使用Kitematic这样的GUI工具辅助你更快的查看运行于机器上的 docker容器, 像是进程管理器，或是开发环境下，像一个运行于本机的Services列表。<br>当然它还存在一些bug, 有时状态并不一定是同步的。<br>如下，展示一下Kitematic的界面，以及在同步的情况下，运行中的容器 和所有已经创建的容器列表的对应</p>
<p><img src="http://oni42o7kl.bkt.clouddn.com/WechatIMG10.jpeg"><br><img src="http://oni42o7kl.bkt.clouddn.com/WechatIMG9.jpeg"></p>
</div><script type="text/javascript" src="/js/share.js?v=0.0.0" async></script><a data-url="http://yoursite.com/2017/08/26/dock/Docker 初级入门/" data-id="cj72tn6p60007s7ntiulmpaal" class="article-share-link">分享到</a><div class="tags"><a href="/tags/Docker/">Docker</a></div><div class="post-nav"><a href="/2017/08/28/php/elasticsearch安装/" class="pre">laravel和elasticsearch</a><a href="/2017/08/26/dock/Docker xunsearch/" class="next">Docker xunsearch</a></div><div data-thread-key="2017/08/26/dock/Docker 初级入门/" data-title="Docker 初级入门" data-url="http://yoursite.com/2017/08/26/dock/Docker 初级入门/" class="ds-share flat"><div class="ds-share-inline"><ul class="ds-share-icons-16"><li data-toggle="ds-share-icons-more"><a href="javascript:void(0);" class="ds-more">分享到：</a></li><li><a href="javascript:void(0);" data-service="weibo" class="ds-weibo">微博</a></li><li><a href="javascript:void(0);" data-service="qzone" class="ds-qzone">QQ空间</a></li><li><a href="javascript:void(0);" data-service="qqt" class="ds-qqt">腾讯微博</a></li><li><a href="javascript:void(0);" data-service="wechat" class="ds-wechat">微信</a></li></ul><div class="ds-share-icons-more"></div></div></div><div data-thread-key="2017/08/26/dock/Docker 初级入门/" data-title="Docker 初级入门" data-url="http://yoursite.com/2017/08/26/dock/Docker 初级入门/" data-author-key="1" class="ds-thread"></div></div></div></div><div class="pure-u-1 pure-u-md-1-4"><div id="sidebar"><div class="widget"><div class="widget-title"><i class="fa fa-folder-o"> 分类</i></div><ul class="category-list"><li class="category-list-item"><a class="category-list-link" href="/categories/Hexo/">Hexo</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/PHP/">PHP</a><span class="category-list-count">10</span><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/PHP/laravel/">laravel</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/PHP/yii/">yii</a><span class="category-list-count">7</span></li></ul></li><li class="category-list-item"><a class="category-list-link" href="/categories/composer/">composer</a><span class="category-list-count">2</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/git/">git</a><span class="category-list-count">2</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/前端之巅/">前端之巅</a><span class="category-list-count">7</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/技术杂谈/">技术杂谈</a><span class="category-list-count">10</span></li></ul></div><div class="widget"><div class="widget-title"><i class="fa fa-star-o"> 标签</i></div><div class="tagcloud"><a href="/tags/composer/" style="font-size: 15px;">composer</a> <a href="/tags/linux/" style="font-size: 15px;">linux</a> <a href="/tags/Docker/" style="font-size: 15px;">Docker</a> <a href="/tags/git/" style="font-size: 15px;">git</a> <a href="/tags/Hexo/" style="font-size: 15px;">Hexo</a> <a href="/tags/php/" style="font-size: 15px;">php</a> <a href="/tags/java/" style="font-size: 15px;">java</a> <a href="/tags/elasticsearch/" style="font-size: 15px;">elasticsearch</a> <a href="/tags/前端/" style="font-size: 15px;">前端</a></div></div><div class="widget"><div class="widget-title"><i class="fa fa-file-o"> 最新文章</i></div><ul class="post-list"><li class="post-list-item"><a class="post-list-link" href="/2017/09/02/memcached/memcached/">memcached安装</a></li><li class="post-list-item"><a class="post-list-link" href="/2017/09/02/redis/redis/">redis安装</a></li><li class="post-list-item"><a class="post-list-link" href="/2017/09/02/composer/composer/">composer</a></li><li class="post-list-item"><a class="post-list-link" href="/2017/09/02/composer/satis/">使用 satis 搭建一个私有的 Composer 包仓库</a></li><li class="post-list-item"><a class="post-list-link" href="/2017/08/28/php/elasticsearch安装/">laravel和elasticsearch</a></li><li class="post-list-item"><a class="post-list-link" href="/2017/08/26/dock/Docker 初级入门/">Docker 初级入门</a></li><li class="post-list-item"><a class="post-list-link" href="/2017/08/26/dock/Docker xunsearch/">Docker xunsearch</a></li><li class="post-list-item"><a class="post-list-link" href="/2017/08/25/php/PHP开发规范/">Java开发规范</a></li><li class="post-list-item"><a class="post-list-link" href="/2017/08/15/前端/vue-upload/">vue上传图片</a></li><li class="post-list-item"><a class="post-list-link" href="/2017/05/07/swoole/swoole之websocket初识/">swoole之websocket初识</a></li></ul></div><div class="widget"><div class="comments-title"><i class="fa fa-comment-o"> 最近评论</i></div><div data-num-items="5" data-show-avatars="0" data-show-time="1" data-show-admin="0" data-excerpt-length="32" data-show-title="1" class="ds-recent-comments"></div></div></div></div><div class="pure-u-1 pure-u-md-3-4"><div id="footer">© <a href="/." rel="nofollow">你总是这样轻言放弃的话，无论多久你都只会原地踏步。.</a> Powered by<a rel="nofollow" target="_blank" href="https://hexo.io"> Hexo.</a><a rel="nofollow" target="_blank" href="https://github.com/tufu9441/maupassant-hexo"> Theme</a> by<a rel="nofollow" target="_blank" href="https://github.com/pagecho"> Cho.</a></div></div></div><a id="rocket" href="#top" class="show"></a><script type="text/javascript" src="/js/totop.js?v=0.0.0" async></script><script type="text/javascript" src="//cdn.bootcss.com/fancybox/2.1.5/jquery.fancybox.pack.js" async></script><script type="text/javascript" src="/js/fancybox.js?v=0.0.0" async></script><link rel="stylesheet" type="text/css" href="/css/jquery.fancybox.css?v=0.0.0"><script>var duoshuoQuery = {short_name:'xiaolinouye'};
(function() {
    var ds = document.createElement('script');
    ds.type = 'text/javascript';ds.async = true;
    ds.src = (document.location.protocol == 'https:' ? 'https:' : 'http:') + '//static.duoshuo.com/embed.js';
    ds.charset = 'UTF-8';
    (document.getElementsByTagName('head')[0]
        || document.getElementsByTagName('body')[0]).appendChild(ds);
})();
</script><script type="text/javascript" src="/js/codeblock-resizer.js?v=0.0.0"></script><script type="text/javascript" src="/js/smartresize.js?v=0.0.0"></script></div></body></html>